---
title: "Fitting a tvem with binary output"
author: "John J. Dziak"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fitting a tvem with binary output}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This example will be similar to the previous one, but with a binary response variable.  

```{r}
library(tvem)
```

The tvem library's simulation function will also simulate binary $y$ if requested by an optional argument.

```{r}
set.seed(123);
the_data <- simulate_tvem_example(simulate_binary=TRUE);
```

When analyzing any dataset, it is important to examine it descriptively first.

```{r}
print(head(the_data));
print(summary(the_data));
```

The simulated dataset is similar to the previous example, but with binary $y$ (0=no, 1=yes) generated from a logistic model.

We can plot the expected log odds over time, using an time-varying-intercept-only logistic model.  The model assumes $\mathrm{logit}(E(Y|t))=\beta_0(t)$.  The binary outcome is specified using the family argument as in R's glm function.


```{r}
model1 <- tvem(data=the_data,
               formula=y~1,
               family=binomial(),
               id=subject_id,
               time=time);
```
               
As before, you can use the default option of an automatic penalty function, or you could specify the number of knots, or you could use automatic selection for the number of knots without a penalty.

A model with covariates works similarly to the previous example also.
               
```{r}
model2 <- tvem(data=the_data,
               formula=y~x1,
               invar_effect=~x2,
               id=subject_id,
               family=binomial(),
               time=time);
print(model2);
plot(model2);
```

The implied mean model is $\mathrm{logit}(E(y|t)) =\beta_0(t)+\beta_1(t)x_1(t) + \beta_2 x_2(t).$  In this simulated example, it isn't very clear whether the effect of $x_1$ changes over time or not, although it seems to do so.  Logistic regression analyses often have wider confidence intervals than ordinary regression analyses with the same sample size.